<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BRRRR Deal Analyzer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <style>
    [v-cloak] { display: none; }
  </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
  <div id="app" class="max-w-6xl mx-auto px-4 py-10" v-cloak>
    <div class="mb-8 text-center">
      <h1 class="text-3xl font-bold tracking-tight">BRRRR Deal Analyzer</h1>
      <p class="text-slate-400 mt-2">Modern dashboard for evaluating your Buy, Rehab, Rent, Refinance strategy.</p>
    </div>

    <div class="grid gap-6 lg:grid-cols-3">
      <div class="lg:col-span-2 space-y-6">
        <!-- Buy & Rehab -->
        <section class="bg-slate-900/70 border border-slate-800 rounded-xl shadow-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h2 class="text-xl font-semibold">Buy &amp; Rehab</h2>
              <p class="text-sm text-slate-400">Acquisition details and hard money terms.</p>
            </div>
          </div>
          <div class="grid md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm text-slate-300 mb-1">Purchase Price ($000s) *</label>
              <input required v-model.number="form.purchasePrice" type="number" step="0.01" placeholder="e.g., 150" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Rehab Cost ($000s)</label>
              <input v-model.number="form.rehabCost" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Closing Costs (Buy) ($000s)</label>
              <input v-model.number="form.closingCostsBuy" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Down Payment (%) *</label>
              <input required v-model.number="form.down_payment" type="number" step="0.01" placeholder="e.g., 20" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">HML Points (%)</label>
              <input v-model.number="form.hmlPoints" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">HML Interest Rate (%) *</label>
              <input required v-model.number="form.HMLInterestRate" type="number" step="0.01" placeholder="e.g., 12" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div class="md:col-span-2 flex items-center space-x-3">
              <input id="useHM" v-model="form.use_HM_for_rehab" type="checkbox" class="h-5 w-5 rounded border-slate-700 bg-slate-950 text-emerald-500 focus:ring-emerald-500" />
              <label for="useHM" class="text-sm text-slate-300">Use hard money to fund rehab costs</label>
            </div>
          </div>
        </section>

        <!-- Refinance -->
        <section class="bg-slate-900/70 border border-slate-800 rounded-xl shadow-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h2 class="text-xl font-semibold">Refinance</h2>
              <p class="text-sm text-slate-400">BRRRR refi assumptions and long-term financing.</p>
            </div>
          </div>
          <div class="grid md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm text-slate-300 mb-1">ARV ($000s) *</label>
              <input required v-model.number="form.arv_in_thousands" type="number" step="0.01" placeholder="e.g., 220" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">LTV (%) *</label>
              <input required v-model.number="form.ltv_as_precent" type="number" step="0.01" placeholder="e.g., 75" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Months until Refi *</label>
              <input required v-model.number="form.monthsUntilRefi" type="number" step="0.01" placeholder="e.g., 6" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Refi Closing Costs ($000s)</label>
              <input v-model.number="form.closingCostsRefi" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Long-term Interest Rate (%) *</label>
              <input required v-model.number="form.interestRate" type="number" step="0.01" placeholder="e.g., 6.5" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Loan Term (Years)</label>
              <input v-model.number="form.loanTermYears" type="number" step="1" min="1" placeholder="30" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
          </div>
        </section>

        <!-- Rent & Expenses -->
        <section class="bg-slate-900/70 border border-slate-800 rounded-xl shadow-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h2 class="text-xl font-semibold">Rent &amp; Expenses</h2>
              <p class="text-sm text-slate-400">Income and operating expense assumptions.</p>
            </div>
          </div>
          <div class="grid md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm text-slate-300 mb-1">Rent ($/mo) *</label>
              <input required v-model.number="form.rent" type="number" step="0.01" placeholder="e.g., 1800" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Annual Taxes ($)</label>
              <input v-model.number="form.annual_property_taxes" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Annual Insurance ($)</label>
              <input v-model.number="form.annual_insurance" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">HOA ($/mo)</label>
              <input v-model.number="form.montly_hoa" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Vacancy (%)</label>
              <input v-model.number="form.vacancyPercent" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Maintenance (%)</label>
              <input v-model.number="form.maintenancePercent" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">CapEx (%)</label>
              <input v-model.number="form.capexPercent" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
            <div>
              <label class="block text-sm text-slate-300 mb-1">Property Management (%)</label>
              <input v-model.number="form.property_managment_fee_precentages_from_rent" type="number" step="0.01" placeholder="0" class="w-full rounded-lg border border-slate-800 bg-slate-950 px-3 py-2 focus:border-emerald-500 focus:ring-emerald-500" />
            </div>
          </div>
        </section>

        <div class="flex items-center space-x-3">
          <button @click="submitForm" :disabled="loading" class="inline-flex items-center justify-center px-6 py-3 text-sm font-semibold rounded-lg bg-emerald-500 hover:bg-emerald-400 text-slate-900 transition disabled:opacity-60 disabled:cursor-not-allowed">
            <svg v-if="loading" class="animate-spin -ml-1 mr-2 h-5 w-5 text-slate-900" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
            <span>{{ loading ? 'Analyzing...' : 'Analyze Deal' }}</span>
          </button>
          <button @click="resetForm" type="button" class="px-4 py-3 text-sm font-semibold rounded-lg border border-slate-700 text-slate-200 hover:bg-slate-800">Reset</button>
        </div>
      </div>

      <!-- Results -->
      <aside class="space-y-6">
        <div class="bg-slate-900/80 border border-slate-800 rounded-xl shadow-xl p-6">
          <h3 class="text-lg font-semibold mb-4">Results</h3>
          <div v-if="apiError" class="mb-4 rounded-lg border border-rose-500/60 bg-rose-500/10 text-rose-100 px-3 py-2 text-sm">{{ apiError }}</div>
          <div v-if="messages.length" class="mb-4 space-y-2">
            <div v-for="(msg, idx) in messages" :key="idx" class="rounded-lg border border-amber-500/40 bg-amber-500/10 text-amber-100 px-3 py-2 text-sm">
              {{ msg }}
            </div>
          </div>
          <div class="space-y-3">
            <ResultRow label="Monthly Cash Flow" :value="formatResult(results.cash_flow, true)"></ResultRow>
            <ResultRow label="DSCR" :value="formatResult(results.dscr)"></ResultRow>
            <ResultRow label="Cash Out" :value="formatResult(results.cash_out, true)"></ResultRow>
            <ResultRow label="Cash on Cash" :value="formatResult(results.cash_on_cash, false, true)"></ResultRow>
            <ResultRow label="ROI" :value="formatResult(results.roi, false, true)"></ResultRow>
            <ResultRow label="Equity" :value="formatResult(results.equity, true)"></ResultRow>
            <ResultRow label="Net Profit" :value="formatResult(results.net_profit, true)"></ResultRow>
            <ResultRow label="Total Cash Needed" :value="formatResult(results.total_cash_needed_for_deal, true)"></ResultRow>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    const { createApp, ref, reactive, computed } = Vue;

    const defaultForm = () => ({
      arv_in_thousands: '',
      purchasePrice: '',
      rehabCost: 0.0,
      closingCostsBuy: 0.0,
      down_payment: '',
      use_HM_for_rehab: false,
      hmlPoints: 0.0,
      monthsUntilRefi: '',
      HMLInterestRate: '',
      closingCostsRefi: 0.0,
      loanTermYears: 30,
      ltv_as_precent: '',
      interestRate: '',
      rent: '',
      vacancyPercent: 0.0,
      property_managment_fee_precentages_from_rent: 0.0,
      maintenancePercent: 0.0,
      capexPercent: 0.0,
      annual_property_taxes: 0.0,
      annual_insurance: 0.0,
      montly_hoa: 0.0,
    });

    const currencyFormatter = new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      maximumFractionDigits: 2,
    });

    const percentFormatter = new Intl.NumberFormat('en-US', {
      style: 'percent',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    });

    const ResultRow = {
      props: ['label', 'value'],
      template: `
        <div class="flex items-center justify-between rounded-lg bg-slate-800/60 px-3 py-2">
          <span class="text-sm text-slate-300">{{ label }}</span>
          <span class="text-base font-semibold" :class="value ? 'text-emerald-200' : 'text-slate-500'">{{ value ?? '—' }}</span>
        </div>
      `,
    };

    createApp({
      components: { ResultRow },
      setup() {
        const form = reactive(defaultForm());
        const loading = ref(false);
        const apiError = ref('');
        const results = reactive({});
        const messages = ref([]);

        const formatSpecial = (val) => {
          if (val === -1) return '∞';
          if (val === -2) return '-∞';
          return null;
        };

        const formatResult = (val, asCurrency = false, asPercent = false) => {
          if (val === undefined || val === null) return null;
          const special = formatSpecial(val);
          if (special) return special;
          if (asCurrency) return currencyFormatter.format(val);
          if (asPercent) return percentFormatter.format(val);
          return Number(val).toFixed(2);
        };

        const resetForm = () => {
          Object.assign(form, defaultForm());
          apiError.value = '';
          messages.value = [];
          Object.keys(results).forEach((k) => delete results[k]);
        };

        const submitForm = async () => {
          apiError.value = '';
          messages.value = [];
          loading.value = true;
          try {
            const payload = { ...form };
            const response = await fetch('https://brrrrdealanalyzer.onrender.com/analyzeDeal', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload),
            });

            const data = await response.json();
            if (!response.ok) {
              apiError.value = data.detail || 'Unable to analyze deal. Please review your inputs.';
              return;
            }
            Object.assign(results, data);
            messages.value = data.messages ?? [];
          } catch (err) {
            apiError.value = 'Network error: unable to reach analyzer API.';
          } finally {
            loading.value = false;
          }
        };

        return {
          form,
          loading,
          apiError,
          results,
          messages,
          submitForm,
          resetForm,
          formatResult,
        };
      },
    }).mount('#app');
  </script>
</body>
</html>
